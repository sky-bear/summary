<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>前端路由</title>
  </head>
  <body>
    <h1>hash模式</h1>
    <nav>
      <a href="#/page1">pag1</a>
      <a href="#/page2">pag3</a>
      <a href="#/page3">pag3</a>
      <a href="#/page4">page4</a>
      <a href="#/page5">page5</a>
      <a href="#">首页</a>
    </nav>
    <div class="container"></div>
  </body>
  <script>
    // hash模式
    class HashRouter {
      constructor() {
        this.routers = {}
        window.addEventListener('hashchange', this.load.bind(this))
      }
      // 注册每个视图
      register(hash, callback = function () {}) {
        this.routers[hash] = callback
      }
      registerIndex(callback = function () {}) {
        this.routers['index'] = callback
      }
      // 处理视图未找到的情况
      registerNotFound(callback = function () {}) {
        this.routers['404'] = callback
      }
      // 处理异常
      registerError(callback = function () {}) {
        this.routers['error'] = callback
      }
      load() {
        const hash = window.location.hash.slice(1)
        let handler
        if (!hash) {
          handler = this.routers['index']
        } else if (!Object.keys(this.routers).includes(hash)) {
          handler = this.routers['404'] || function () {}
        } else {
          handler = this.routers[hash]
        }
        try {
          handler.call(this)
        } catch (error) {
          console.log(error)
          ;(this.routers['error'] || function () {}).call(this, error)
        }
      }
    }
    // 演示
    const router = new HashRouter()
    const container = document.querySelector('.container')
    router.registerIndex(() => (container.innerHTML = '我是首页'))

    //注册其他视图回到函数
    router.register('/page1', () => (container.innerHTML = '我是page1'))
    router.register('/page2', () => (container.innerHTML = '我是page2'))
    router.register('/page3', () => (container.innerHTML = '我是page3'))
    router.register('/page4', () => {
      throw new Error('抛出一个异常')
    })
    //注册未找到对应hash值时的回调
    router.registerNotFound(() => (container.innerHTML = '页面未找到'))
    //注册出现异常时的回调
    router.registerError(
      e => (container.innerHTML = '页面异常，错误消息：<br>' + e.message)
    )

    router.load()
  </script>
</html>
